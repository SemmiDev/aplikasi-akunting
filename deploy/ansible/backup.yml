---
# Manual backup playbook
# Usage: ansible-playbook -i inventory.ini backup.yml
#
# This playbook runs an immediate backup without waiting for cron schedule.
# The backup file will be created at /opt/{{ app_name }}/backup/

- name: Run Manual Backup
  hosts: accounting
  become: yes
  become_user: "{{ app_user }}"

  tasks:
    - name: Run backup script
      ansible.builtin.command:
        cmd: "/opt/{{ app_name }}/scripts/backup.sh"
      register: backup_result
      changed_when: true

    - name: Display backup result
      ansible.builtin.debug:
        msg: "{{ backup_result.stdout_lines }}"

    - name: Show backup file location
      ansible.builtin.debug:
        msg: "Backup created: {{ backup_result.stdout_lines[-1] }}"
      when: backup_result.rc == 0
